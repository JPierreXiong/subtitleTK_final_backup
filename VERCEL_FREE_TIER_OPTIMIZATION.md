# Vercel Free ç‰ˆä¼˜åŒ–è¯´æ˜

## å·²å®æ–½çš„ä¼˜åŒ–

### 1. ç¼©çŸ­ API è¶…æ—¶æ—¶é—´ âœ…

**æ–‡ä»¶**ï¼š`src/extensions/media/rapidapi.ts`

- âœ… `DEFAULT_TIMEOUT`: ä» 180 ç§’ï¼ˆ3åˆ†é’Ÿï¼‰ç¼©çŸ­åˆ° **8 ç§’**
- âœ… `FREE_API_TIMEOUT`: ä» 15 ç§’ç¼©çŸ­åˆ° **8 ç§’**
- âœ… `PAID_API_TIMEOUT`: ä» 20 ç§’ç¼©çŸ­åˆ° **8 ç§’**

**åŸå› **ï¼š
- Vercel Free ç‰ˆé™åˆ¶ï¼š10 ç§’
- è®¾ç½®ä¸º 8 ç§’ç•™å‡º 2 ç§’ç¼“å†²ï¼Œç¡®ä¿åœ¨é™åˆ¶å†…å®Œæˆ

### 2. ä½¿ç”¨ setTimeout å»¶è¿Ÿæ‰§è¡Œ âœ…

**æ–‡ä»¶**ï¼š`src/app/api/media/submit/route.ts`

**ä¿®æ”¹å‰**ï¼š
```typescript
processMediaTask(...).catch(...);
```

**ä¿®æ”¹å**ï¼š
```typescript
setTimeout(() => {
  processMediaTask(...).catch(...);
}, 100); // å»¶è¿Ÿ 100msï¼Œç¡®ä¿å“åº”å…ˆè¿”å›
```

**æ•ˆæœ**ï¼š
- ä¸»çº¿ç¨‹ç«‹å³è¿”å›å“åº”ï¼ˆ< 1 ç§’ï¼‰
- åå°ä»»åŠ¡å»¶è¿Ÿ 100ms åæ‰§è¡Œ
- ç¡®ä¿åœ¨ Vercel Free ç‰ˆçš„ 10 ç§’é™åˆ¶å†…å®Œæˆå“åº”

### 3. ä¼˜åŒ–æ•´ä½“è¶…æ—¶ä¿æŠ¤ âœ…

**æ–‡ä»¶**ï¼š`src/app/api/media/submit/route.ts`

- âœ… `API_CALL_TIMEOUT`: ä» 4 åˆ†é’Ÿç¼©çŸ­åˆ° **8 ç§’**
- âœ… ä½œä¸ºå®‰å…¨ç½‘ï¼Œé˜²æ­¢ API è°ƒç”¨è¶…æ—¶

## æ‰§è¡Œæµç¨‹

```
1. ç”¨æˆ·æäº¤ä»»åŠ¡
   â†“
2. POST /api/media/submit
   â†“
3. åˆ›å»ºä»»åŠ¡è®°å½•ï¼ˆæ•°æ®åº“ï¼‰[< 1ç§’]
   â†“
4. æ¶ˆè´¹ç§¯åˆ†ï¼ˆæ•°æ®åº“äº‹åŠ¡ï¼‰[< 1ç§’]
   â†“
5. setTimeout(() => processMediaTask(), 100) [ç«‹å³è¿”å›]
   â†“
6. ç«‹å³è¿”å› taskId [âœ… æ€»æ—¶é—´ < 2ç§’]
   â†“
7. [100ms å] processMediaTask() å¼€å§‹æ‰§è¡Œ
   â”œâ”€ æ›´æ–°çŠ¶æ€ä¸º processing [< 1ç§’]
   â”œâ”€ æ£€æŸ¥ç¼“å­˜ [< 1ç§’]
   â”œâ”€ è°ƒç”¨ RapidAPIï¼ˆæœ€å¤š 8 ç§’è¶…æ—¶ï¼‰
   â”œâ”€ å¤„ç†è§†é¢‘/å­—å¹•
   â””â”€ æ›´æ–°çŠ¶æ€ä¸º extracted/failed
```

## å…³é”®ä¼˜åŒ–ç‚¹

### 1. ç¼“å­˜ä¼˜å…ˆç­–ç•¥
- âœ… è§†é¢‘ä¸‹è½½ä»»åŠ¡ä¼˜å…ˆæ£€æŸ¥ç¼“å­˜
- âœ… ç¼“å­˜å‘½ä¸­æ—¶ï¼Œå¤„ç†æ—¶é—´ < 5 ç§’
- âœ… é¿å…ä¸å¿…è¦çš„ API è°ƒç”¨

### 2. å¿«é€Ÿå¤±è´¥æœºåˆ¶
- âœ… API è°ƒç”¨ 8 ç§’è¶…æ—¶
- âœ… è¶…æ—¶åç«‹å³æ ‡è®°ä¸ºå¤±è´¥
- âœ… è‡ªåŠ¨è§¦å‘é€€æ¬¾é€»è¾‘

### 3. å¼‚æ­¥å¤„ç†
- âœ… ä½¿ç”¨ `setTimeout` å»¶è¿Ÿæ‰§è¡Œ
- âœ… ç¡®ä¿å“åº”åœ¨ 2 ç§’å†…è¿”å›
- âœ… åå°ä»»åŠ¡ç‹¬ç«‹æ‰§è¡Œ

## é™åˆ¶å’Œæ³¨æ„äº‹é¡¹

### âš ï¸ Vercel Free ç‰ˆçš„é™åˆ¶

1. **æ‰§è¡Œæ—¶é—´é™åˆ¶**ï¼š
   - å³ä½¿ä½¿ç”¨äº† `setTimeout`ï¼Œå¦‚æœåå°ä»»åŠ¡æ‰§è¡Œæ—¶é—´è¶…è¿‡ 10 ç§’ï¼Œä»å¯èƒ½è¢«ç»ˆæ­¢
   - å»ºè®®ä¼˜å…ˆä½¿ç”¨ç¼“å­˜ï¼Œé¿å…é•¿æ—¶é—´ API è°ƒç”¨

2. **API è°ƒç”¨é™åˆ¶**ï¼š
   - 8 ç§’è¶…æ—¶å¯èƒ½å¯¹æŸäº›æ…¢é€Ÿ API ä¸å¤Ÿ
   - å¦‚æœ API å“åº”æ…¢ï¼Œä»»åŠ¡ä¼šå¤±è´¥å¹¶é€€æ¬¾

3. **å»ºè®®**ï¼š
   - ä¼˜å…ˆä½¿ç”¨ç¼“å­˜
   - å¦‚æœä»»åŠ¡é¢‘ç¹å¤±è´¥ï¼Œè€ƒè™‘å‡çº§åˆ° Vercel Pro
   - æˆ–ä½¿ç”¨å¤–éƒ¨ä»»åŠ¡é˜Ÿåˆ—ï¼ˆå¦‚ Upstash Queueï¼‰

## æµ‹è¯•å»ºè®®

1. **æµ‹è¯•å¿«é€Ÿè·¯å¾„**ï¼ˆç¼“å­˜å‘½ä¸­ï¼‰ï¼š
   - æäº¤å·²ç¼“å­˜çš„è§†é¢‘ URL
   - éªŒè¯å“åº”æ—¶é—´ < 2 ç§’
   - éªŒè¯ä»»åŠ¡çŠ¶æ€æ­£å¸¸æ›´æ–°

2. **æµ‹è¯•æ…¢é€Ÿè·¯å¾„**ï¼ˆAPI è°ƒç”¨ï¼‰ï¼š
   - æäº¤æ–°çš„è§†é¢‘ URL
   - éªŒè¯ API è°ƒç”¨åœ¨ 8 ç§’å†…å®Œæˆæˆ–è¶…æ—¶
   - éªŒè¯è¶…æ—¶åä»»åŠ¡æ­£ç¡®æ ‡è®°ä¸ºå¤±è´¥å¹¶é€€æ¬¾

3. **ç›‘æ§ Vercel Logs**ï¼š
   - æ£€æŸ¥æ˜¯å¦æœ‰ "Function execution timeout" é”™è¯¯
   - æ£€æŸ¥ä»»åŠ¡å¤„ç†æ—¶é—´
   - æ£€æŸ¥é€€æ¬¾é€»è¾‘æ˜¯å¦æ­£å¸¸è§¦å‘

## åç»­ä¼˜åŒ–å»ºè®®

### çŸ­æœŸï¼ˆFree ç‰ˆï¼‰
1. âœ… å·²å®ç°ï¼šç¼©çŸ­è¶…æ—¶æ—¶é—´åˆ° 8 ç§’
2. âœ… å·²å®ç°ï¼šä½¿ç”¨ setTimeout å»¶è¿Ÿæ‰§è¡Œ
3. ğŸ’¡ å»ºè®®ï¼šå¢åŠ æ›´å¤šç¼“å­˜ç­–ç•¥
4. ğŸ’¡ å»ºè®®ï¼šä¼˜åŒ–é”™è¯¯å¤„ç†ï¼Œæä¾›æ›´å‹å¥½çš„é”™è¯¯ä¿¡æ¯

### é•¿æœŸï¼ˆæ¨èå‡çº§ï¼‰
1. **å‡çº§åˆ° Vercel Pro**ï¼š
   - æ”¯æŒæœ€é•¿ 60 ç§’ï¼ˆå¯é…ç½®åˆ° 300 ç§’ï¼‰
   - æ›´å¥½çš„æ€§èƒ½å’Œå¯é æ€§

2. **ä½¿ç”¨ä»»åŠ¡é˜Ÿåˆ—**ï¼š
   - Vercel Queueï¼ˆéœ€è¦ Pro ç‰ˆï¼‰
   - Upstash Queueï¼ˆå…è´¹é¢åº¦ï¼‰
   - Inngestï¼ˆå…è´¹é¢åº¦ï¼‰

3. **ä½¿ç”¨å¤–éƒ¨æœåŠ¡**ï¼š
   - å°†è§†é¢‘å¤„ç†å§”æ‰˜ç»™ä¸“é—¨çš„æœåŠ¡
   - ä½¿ç”¨ Webhook é€šçŸ¥ä»»åŠ¡å®Œæˆ

## ç›¸å…³æ–‡ä»¶

- `src/extensions/media/rapidapi.ts` - API è°ƒç”¨è¶…æ—¶é…ç½®
- `src/app/api/media/submit/route.ts` - ä»»åŠ¡æäº¤å’Œå¼‚æ­¥å¤„ç†
- `src/app/api/media/status/route.ts` - ä»»åŠ¡çŠ¶æ€æŸ¥è¯¢ï¼ˆå·²æœ‰è¶…æ—¶ä¿æŠ¤ï¼‰
- `vercel.json` - Vercel é…ç½®ï¼ˆFree ç‰ˆä¸æ”¯æŒè¶…è¿‡ 10 ç§’ï¼‰

