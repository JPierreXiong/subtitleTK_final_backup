# å®æ–½æ–¹æ¡ˆï¼šä¸¤é˜¶æ®µæå–ç¿»è¯‘æµç¨‹

## ğŸ“‹ æ¦‚è¿°

åŸºäºæœ€ç»ˆæŠ€æœ¯è§„æ ¼è¯´æ˜ï¼Œåœ¨**ä¸æ”¹å˜ShipAnyç»“æ„**çš„å‰æä¸‹ï¼Œå®ç°ä¸¤é˜¶æ®µUIæµç¨‹ï¼ˆæå–â†’ç¿»è¯‘ï¼‰å’Œå®Œæ•´çš„æŠ€æœ¯æ ˆé›†æˆã€‚

**æŠ€æœ¯æ ˆç¡®è®¤ï¼š**
- âœ… ShipAnyæ¡†æ¶ï¼ˆä¸æ”¹åŠ¨ç»“æ„ï¼‰
- âœ… RapidAPIï¼ˆå­—å¹•æå– + è§†é¢‘ä¸‹è½½ï¼‰
- âœ… Supabaseï¼ˆæ•°æ®åº“ï¼ŒNeon PostgreSQLï¼‰
- âœ… Vercel Blobï¼ˆè§†é¢‘å­˜å‚¨ï¼‰
- âœ… Gemini 1.5 Flashï¼ˆç¿»è¯‘ï¼‰
- âœ… Verceléƒ¨ç½²

---

## ğŸ¯ æ ¸å¿ƒéœ€æ±‚ç¡®è®¤

### 1. UIäº¤äº’æµç¨‹
- **ç¬¬ä¸€é˜¶æ®µï¼ˆæå–ï¼‰**ï¼šç”¨æˆ·ç‚¹å‡»"æå–" â†’ 3åˆ†é’Ÿå¤„ç† â†’ å®Œæˆåæ¿€æ´»"å¼€å§‹ç¿»è¯‘"æŒ‰é’®
- **ç¬¬äºŒé˜¶æ®µï¼ˆç¿»è¯‘ï¼‰**ï¼šç”¨æˆ·é€‰æ‹©è¯­è¨€ â†’ ç‚¹å‡»"å¼€å§‹ç¿»è¯‘" â†’ 1åˆ†é’Ÿå¤„ç† â†’ å®Œæˆ

### 2. æ•°æ®åº“å­—æ®µï¼ˆå·²å­˜åœ¨ï¼Œæ— éœ€ä¿®æ”¹ï¼‰
- âœ… `subtitle_raw` (text) - åŸå§‹å­—å¹•æ–‡æœ¬
- âœ… `subtitle_translated` (text) - ç¿»è¯‘åå­—å¹•æ–‡æœ¬
- âœ… `video_url_internal` (text) - Vercel Blobå­˜å‚¨æ ‡è¯†ç¬¦ï¼ˆæ ¼å¼ï¼š`vercel-blob:https://...`ï¼‰
- âœ… `expires_at` (timestamp) - 24å°æ—¶è¿‡æœŸæ—¶é—´
- âœ… `target_lang` (text) - ç”¨æˆ·é€‰æ‹©çš„ç›®æ ‡è¯­è¨€ï¼ˆå¤ç”¨ç°æœ‰å­—æ®µï¼‰
- âœ… `output_type` (text) - 'subtitle' | 'video'
- âœ… `status` (text) - pending, processing, extracted, translating, completed, failed

### 3. RapidAPIé…ç½®
- **YouTubeå­—å¹•**ï¼š`youtube-transcriptor.p.rapidapi.com`
- **TikTokå­—å¹•**ï¼š`tiktok-transcriptor-api3.p.rapidapi.com`
- **TikTokä¸‹è½½**ï¼š`tiktok-download-video1.p.rapidapi.com`ï¼ˆéœ€é€‚é…"Download Video by URL"ç«¯ç‚¹ï¼‰

---

## ğŸ”§ å®æ–½æ–¹æ¡ˆï¼ˆä¸æ”¹åŠ¨ShipAnyç»“æ„ï¼‰

### Phase 1: RapidAPIé€‚é…å™¨å¢å¼º

#### 1.1 TikTokè§†é¢‘ä¸‹è½½ç«¯ç‚¹é€‚é…

**æ–‡ä»¶ï¼š** `src/extensions/media/rapidapi.ts`

**éœ€è¦æ·»åŠ çš„æ–¹æ³•ï¼š**
```typescript
/**
 * Fetch TikTok video download via RapidAPI
 * Uses "Download Video by URL" endpoint from tiktok-download-video1
 * @param url TikTok video URL
 * @returns Normalized media data with video URL
 */
private async fetchTikTokVideo(url: string): Promise<NormalizedMediaData> {
  // 1. è°ƒç”¨ tiktok-download-video1 çš„ "Download Video by URL" ç«¯ç‚¹
  // 2. ä»å“åº”ä¸­æå– video_url æˆ– download_addrï¼ˆæ— æ°´å°è§†é¢‘URLï¼‰
  // 3. è¿”å›æ ‡å‡†åŒ–æ•°æ®ï¼ŒåŒ…å« videoUrl å­—æ®µ
}
```

**å®ç°è¦ç‚¹ï¼š**
- ä½¿ç”¨é…ç½®ä¸­çš„ `tiktokVideo.primaryHost` æˆ– `tiktokVideo.backupHost`
- å“åº”æ ¼å¼é€‚é…ï¼š`{ data: { play: "...", download_addr: "..." } }` æˆ–ç±»ä¼¼æ ¼å¼
- æå–è§†é¢‘URLï¼šä¼˜å…ˆä½¿ç”¨ `download_addr`ï¼Œå…¶æ¬¡ `play`ï¼Œæœ€å `video_url`

#### 1.2 å­—å¹•æ ¼å¼æ ‡å‡†åŒ–è½¬æ¢å™¨

**æ–‡ä»¶ï¼š** `src/extensions/media/subtitle-formatter.ts`ï¼ˆå·²å­˜åœ¨ï¼Œéœ€å¢å¼ºï¼‰

**éœ€è¦å¢å¼ºçš„åŠŸèƒ½ï¼š**
```typescript
/**
 * Normalize subtitle format to SRT
 * Handles multiple input formats: JSON array, VTT, raw SRT
 * @param subtitleData Raw subtitle data from RapidAPI
 * @param platform Platform type ('youtube' | 'tiktok')
 * @returns Standardized SRT string
 */
normalizeSubtitles(subtitleData: any, platform: 'youtube' | 'tiktok'): string {
  // 1. æ£€æµ‹æ ¼å¼ç±»å‹ï¼ˆJSONæ•°ç»„ / VTT / SRTï¼‰
  // 2. è½¬æ¢ä¸ºæ ‡å‡†SRTæ ¼å¼
  // 3. ç¡®ä¿æ—¶é—´æˆ³æ ¼å¼æ­£ç¡®ï¼š00:00:00,000 --> 00:00:01,000
}
```

**æ ¼å¼è½¬æ¢é€»è¾‘ï¼š**
- **JSONæ•°ç»„** â†’ SRTï¼š
  ```typescript
  // è¾“å…¥ï¼š[{ start: 0, duration: 1.5, text: "Hello" }]
  // è¾“å‡ºï¼šæ ‡å‡†SRTæ ¼å¼
  ```
- **VTT** â†’ SRTï¼šç§»é™¤VTTå¤´éƒ¨ï¼Œè½¬æ¢æ—¶é—´æˆ³æ ¼å¼ï¼ˆ`.` â†’ `,`ï¼‰
- **SRT**ï¼šç›´æ¥è¿”å›ï¼ˆéªŒè¯æ ¼å¼ï¼‰

#### 1.3 å…ƒæ•°æ®æ ‡å‡†åŒ–æ˜ å°„å™¨

**æ–‡ä»¶ï¼š** `src/extensions/media/rapidapi.ts`ï¼ˆåœ¨ `normalizeMetadata` æ–¹æ³•ä¸­ï¼‰

**éœ€è¦å¢å¼ºçš„é€»è¾‘ï¼š**
```typescript
/**
 * Normalize metadata from RapidAPI response
 * Handles different field naming conventions
 * @param data Raw API response data
 * @param platform Platform type
 * @returns Normalized metadata
 */
private normalizeMetadata(data: any, platform: 'youtube' | 'tiktok'): NormalizedMetadata {
  // TikTokå­—æ®µæ˜ å°„ï¼š
  // - title: data.desc || data.title || data.video_title
  // - likes: data.statistics?.digg_count || data.likes || data.statistics?.likes
  // - views: data.statistics?.play_count || data.views || data.statistics?.views
  // - shares: data.statistics?.share_count || data.shares || data.statistics?.shares
  
  // YouTubeå­—æ®µæ˜ å°„ï¼š
  // - title: data.title || data.snippet?.title
  // - likes: data.statistics?.likeCount || data.likes
  // - views: data.statistics?.viewCount || data.views
  // - shares: data.statistics?.shareCount || data.shares
}
```

**å…¼å®¹æ€§å¤„ç†ï¼š**
- å¦‚æœ `data.digg_count` ä¸å­˜åœ¨ï¼Œå°è¯• `data.likes`
- å¦‚æœ `data.play_count` ä¸å­˜åœ¨ï¼Œå°è¯• `data.views`
- ç¡®ä¿æ‰€æœ‰å­—æ®µéƒ½æœ‰é»˜è®¤å€¼ï¼ˆ0 æˆ– nullï¼‰

---

### Phase 2: è§†é¢‘å­˜å‚¨æµç¨‹ä¼˜åŒ–

#### 2.1 Vercel Blobå­˜å‚¨æ ‡è¯†ç¬¦æ ¼å¼

**æ–‡ä»¶ï¼š** `src/shared/services/media/video-storage.ts`

**å½“å‰å®ç°ï¼š** âœ… å·²æ­£ç¡®å®ç°
- è¿”å›æ ¼å¼ï¼š`vercel-blob:https://xxx.vercel-storage.com/...`
- å­˜å‚¨keyï¼š`videos/${nanoid()}-${Date.now()}.mp4`

**æ— éœ€ä¿®æ”¹ï¼Œä½†éœ€ç¡®è®¤ï¼š**
- `video_url_internal` å­˜å‚¨çš„æ˜¯å®Œæ•´æ ‡è¯†ç¬¦ï¼ˆåŒ…å« `vercel-blob:` å‰ç¼€ï¼‰
- ä¸‹è½½æ—¶é€šè¿‡ `getVideoDownloadUrl` è§£æå¹¶è¿”å›å®é™…URL

#### 2.2 è¿‡æœŸæ—¶é—´è®¾ç½®

**æ–‡ä»¶ï¼š** `src/app/api/media/submit/route.ts`ï¼ˆ`processMediaTask` å‡½æ•°ï¼‰

**å½“å‰é€»è¾‘ï¼š** âœ… å·²æ­£ç¡®å®ç°
- TikTokè§†é¢‘ï¼š24å°æ—¶ï¼ˆä¸Šä¼ åˆ°å­˜å‚¨ï¼‰æˆ–2å°æ—¶ï¼ˆä½¿ç”¨åŸå§‹URLï¼‰
- YouTubeè§†é¢‘ï¼š2å°æ—¶ï¼ˆä½¿ç”¨åŸå§‹URLï¼‰

**æ— éœ€ä¿®æ”¹ã€‚**

---

### Phase 3: ç¿»è¯‘æµç¨‹é›†æˆ

#### 3.1 ç¿»è¯‘APIè·¯ç”±ï¼ˆå·²å­˜åœ¨ï¼‰

**æ–‡ä»¶ï¼š** `src/app/api/media/translate/route.ts`

**å½“å‰å®ç°ï¼š** âœ… å·²å®Œæ•´å®ç°
- éªŒè¯ä»»åŠ¡çŠ¶æ€ï¼ˆå¿…é¡»æ˜¯ `extracted`ï¼‰
- æ£€æŸ¥å­—å¹•å†…å®¹ï¼ˆ`subtitleRaw` å¿…é¡»å­˜åœ¨ï¼‰
- æ£€æŸ¥ç¿»è¯‘å­—ç¬¦é™åˆ¶
- æ‰£é™¤ç§¯åˆ†
- è°ƒç”¨ Gemini ç¿»è¯‘
- ä¿å­˜ `subtitleTranslated`
- çŠ¶æ€æ›´æ–°ä¸º `completed`

**æ— éœ€ä¿®æ”¹ã€‚**

#### 3.2 ç¿»è¯‘çŠ¶æ€ç®¡ç†

**éœ€è¦å¢å¼ºï¼š** æ·»åŠ  `translating` çŠ¶æ€

**æ–‡ä»¶ï¼š** `src/app/api/media/translate/route.ts`

**ä¿®æ”¹ç‚¹ï¼š**
```typescript
// åœ¨ç¿»è¯‘å¼€å§‹å‰ï¼Œæ›´æ–°çŠ¶æ€ä¸º 'translating'
await updateMediaTaskById(taskId, {
  status: 'translating',
  progress: 0,
  targetLang: targetLanguage, // ä¿å­˜ç›®æ ‡è¯­è¨€
});

// ç¿»è¯‘å®Œæˆåï¼Œæ›´æ–°ä¸º 'completed'
await updateMediaTaskById(taskId, {
  subtitleTranslated: translatedSRT,
  status: 'completed',
  progress: 100,
});
```

---

### Phase 4: å‰ç«¯UIä¸¤é˜¶æ®µæµç¨‹

#### 4.1 çŠ¶æ€ç®¡ç†å¢å¼º

**æ–‡ä»¶ï¼š** `src/shared/hooks/use-media-task.ts`

**éœ€è¦æ·»åŠ çš„æ–¹æ³•ï¼š**
```typescript
/**
 * Start translation for a media task
 * @param taskId Task ID
 * @param targetLanguage Target language code
 */
async function startTranslation(taskId: string, targetLanguage: string): Promise<void> {
  const response = await fetch('/api/media/translate', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ taskId, targetLanguage }),
  });
  
  const data = await response.json();
  if (data.code !== 0) {
    throw new Error(data.message || 'Translation failed');
  }
  
  // å¼€å§‹è½®è¯¢ç¿»è¯‘çŠ¶æ€
  startPolling(taskId);
}
```

#### 4.2 UIç»„ä»¶ä¿®æ”¹

**æ–‡ä»¶ï¼š** `src/shared/blocks/generator/media.tsx`

**éœ€è¦å®ç°çš„é€»è¾‘ï¼š**

1. **ç¬¬ä¸€é˜¶æ®µï¼ˆæå–ï¼‰**ï¼š
   ```typescript
   // æå–æŒ‰é’®ï¼šå§‹ç»ˆå¯ç”¨ï¼ˆå¦‚æœURLæœ‰æ•ˆï¼‰
   <Button onClick={handleExtract} disabled={!url || isExtracting}>
     æå–
   </Button>
   
   // æå–ä¸­ï¼šæ˜¾ç¤ºè¿›åº¦æ¡
   {isExtracting && (
     <Progress value={taskStatus?.progress || 0} />
   )}
   ```

2. **ç¬¬äºŒé˜¶æ®µï¼ˆç¿»è¯‘ï¼‰**ï¼š
   ```typescript
   // ç¿»è¯‘æŒ‰é’®ï¼šä»…åœ¨ status === 'extracted' æ—¶å¯ç”¨
   <Button 
     onClick={handleTranslate}
     disabled={taskStatus?.status !== 'extracted' || !selectedTranslationLang}
   >
     å¼€å§‹ç¿»è¯‘
   </Button>
   
   // è¯­è¨€é€‰æ‹©ï¼šä»…åœ¨ status === 'extracted' æ—¶æ˜¾ç¤º
   {taskStatus?.status === 'extracted' && (
     <Select value={selectedTranslationLang} onValueChange={setSelectedTranslationLang}>
       {/* 12ç§è¯­è¨€é€‰é¡¹ */}
     </Select>
   )}
   
   // ç¿»è¯‘ä¸­ï¼šæ˜¾ç¤ºè¿›åº¦æ¡
   {taskStatus?.status === 'translating' && (
     <Progress value={taskStatus?.progress || 0} />
   )}
   ```

3. **ç»“æœå±•ç¤º**ï¼š
   ```typescript
   // æå–å®Œæˆï¼šæ˜¾ç¤ºåŸå§‹å­—å¹•
   {taskStatus?.status === 'extracted' && taskStatus?.subtitleRaw && (
     <SubtitlePreview content={taskStatus.subtitleRaw} />
   )}
   
   // ç¿»è¯‘å®Œæˆï¼šæ˜¾ç¤ºç¿»è¯‘åå­—å¹•
   {taskStatus?.status === 'completed' && taskStatus?.subtitleTranslated && (
     <SubtitlePreview content={taskStatus.subtitleTranslated} />
   )}
   ```

---

## ğŸ“ å®æ–½æ­¥éª¤æ¸…å•

### Step 1: RapidAPIé€‚é…å™¨å¢å¼ºï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰

- [ ] 1.1 æ·»åŠ  `fetchTikTokVideo` æ–¹æ³•
  - [ ] å®ç° TikTok è§†é¢‘ä¸‹è½½ç«¯ç‚¹è°ƒç”¨
  - [ ] å¤„ç†å“åº”æ ¼å¼ï¼ˆ`download_addr` / `play` / `video_url`ï¼‰
  - [ ] é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

- [ ] 1.2 å¢å¼ºå­—å¹•æ ¼å¼è½¬æ¢å™¨
  - [ ] JSONæ•°ç»„ â†’ SRT è½¬æ¢
  - [ ] VTT â†’ SRT è½¬æ¢
  - [ ] SRTæ ¼å¼éªŒè¯

- [ ] 1.3 å¢å¼ºå…ƒæ•°æ®æ˜ å°„å™¨
  - [ ] TikTokå­—æ®µæ˜ å°„ï¼ˆ`digg_count` â†’ `likes`ï¼‰
  - [ ] YouTubeå­—æ®µæ˜ å°„ï¼ˆ`likeCount` â†’ `likes`ï¼‰
  - [ ] é»˜è®¤å€¼å¤„ç†

### Step 2: ç¿»è¯‘æµç¨‹ä¼˜åŒ–ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰

- [ ] 2.1 ä¿®æ”¹ç¿»è¯‘APIè·¯ç”±
  - [ ] æ·»åŠ  `translating` çŠ¶æ€æ›´æ–°
  - [ ] ä¿å­˜ `targetLang` å­—æ®µ
  - [ ] è¿›åº¦æ›´æ–°ï¼ˆ0-100%ï¼‰

- [ ] 2.2 å‰ç«¯Hookå¢å¼º
  - [ ] æ·»åŠ  `startTranslation` æ–¹æ³•
  - [ ] ç¿»è¯‘çŠ¶æ€è½®è¯¢
  - [ ] é”™è¯¯å¤„ç†

### Step 3: å‰ç«¯UIå®ç°ï¼ˆä¼˜å…ˆçº§ï¼šä¸­ï¼‰

- [ ] 3.1 ä¿®æ”¹MediaExtractorç»„ä»¶
  - [ ] ä¸¤é˜¶æ®µæŒ‰é’®é€»è¾‘
  - [ ] è¿›åº¦æ¡æ˜¾ç¤º
  - [ ] è¯­è¨€é€‰æ‹©å™¨ï¼ˆä»…åœ¨ `extracted` çŠ¶æ€æ˜¾ç¤ºï¼‰
  - [ ] ç»“æœå±•ç¤ºåŒºåŸŸ

- [ ] 3.2 çŠ¶æ€ç®¡ç†
  - [ ] æå–çŠ¶æ€ï¼š`pending` â†’ `processing` â†’ `extracted`
  - [ ] ç¿»è¯‘çŠ¶æ€ï¼š`extracted` â†’ `translating` â†’ `completed`
  - [ ] é”™è¯¯çŠ¶æ€ï¼š`failed`

### Step 4: æµ‹è¯•å’ŒéªŒè¯ï¼ˆä¼˜å…ˆçº§ï¼šä¸­ï¼‰

- [ ] 4.1 TikTokè§†é¢‘ä¸‹è½½æµ‹è¯•
  - [ ] æµ‹è¯• `tiktok-download-video1` ç«¯ç‚¹
  - [ ] éªŒè¯è§†é¢‘URLæå–
  - [ ] éªŒè¯Vercel Blobä¸Šä¼ 

- [ ] 4.2 å­—å¹•æ ¼å¼è½¬æ¢æµ‹è¯•
  - [ ] JSONæ•°ç»„æ ¼å¼
  - [ ] VTTæ ¼å¼
  - [ ] SRTæ ¼å¼

- [ ] 4.3 ç¿»è¯‘æµç¨‹æµ‹è¯•
  - [ ] ä¸¤é˜¶æ®µæµç¨‹å®Œæ•´æ€§
  - [ ] çŠ¶æ€è½¬æ¢æ­£ç¡®æ€§
  - [ ] é”™è¯¯å¤„ç†

---

## ğŸ” å…³é”®ä»£ç ä½ç½®

### åç«¯æ ¸å¿ƒæ–‡ä»¶

1. **RapidAPIé€‚é…å™¨**
   - `src/extensions/media/rapidapi.ts` - ä¸»é€‚é…å™¨ç±»
   - `src/extensions/media/subtitle-formatter.ts` - å­—å¹•æ ¼å¼åŒ–

2. **è§†é¢‘å­˜å‚¨**
   - `src/shared/services/media/video-storage.ts` - å­˜å‚¨æœåŠ¡
   - `src/extensions/storage/vercel-blob.ts` - Vercel Blobæä¾›è€…

3. **ç¿»è¯‘æœåŠ¡**
   - `src/shared/services/media/gemini-translator.ts` - Geminiç¿»è¯‘å™¨
   - `src/app/api/media/translate/route.ts` - ç¿»è¯‘APIè·¯ç”±

4. **ä»»åŠ¡å¤„ç†**
   - `src/app/api/media/submit/route.ts` - ä»»åŠ¡æäº¤å’Œå¤„ç†
   - `src/shared/models/media_task.ts` - ä»»åŠ¡æ¨¡å‹

### å‰ç«¯æ ¸å¿ƒæ–‡ä»¶

1. **UIç»„ä»¶**
   - `src/shared/blocks/generator/media.tsx` - ä¸»æå–å™¨ç»„ä»¶

2. **çŠ¶æ€ç®¡ç†**
   - `src/shared/hooks/use-media-task.ts` - ä»»åŠ¡Hook

3. **æ•°æ®åº“Schema**
   - `src/config/db/schema.ts` - æ•°æ®åº“å®šä¹‰ï¼ˆæ— éœ€ä¿®æ”¹ï¼‰

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. ShipAnyç»“æ„ä¿æŠ¤

- âœ… **ä¸æ”¹åŠ¨**ï¼š`src/core/` ç›®å½•ç»“æ„
- âœ… **ä¸æ”¹åŠ¨**ï¼šæ•°æ®åº“Schemaå®šä¹‰æ–¹å¼ï¼ˆDrizzle ORMï¼‰
- âœ… **ä¸æ”¹åŠ¨**ï¼šè®¤è¯å’Œæƒé™ç³»ç»Ÿ
- âœ… **ä¸æ”¹åŠ¨**ï¼šé…ç½®ç®¡ç†æ–¹å¼

### 2. å…¼å®¹æ€§å¤„ç†

- **RapidAPIå“åº”æ ¼å¼**ï¼šä¸åŒAPIå¯èƒ½è¿”å›ä¸åŒæ ¼å¼ï¼Œéœ€è¦å…¼å®¹å±‚
- **å­—å¹•æ ¼å¼**ï¼šæ”¯æŒå¤šç§è¾“å…¥æ ¼å¼ï¼Œç»Ÿä¸€è½¬æ¢ä¸ºSRT
- **å…ƒæ•°æ®å­—æ®µ**ï¼šä¸åŒå¹³å°å­—æ®µå‘½åä¸åŒï¼Œéœ€è¦æ˜ å°„

### 3. é”™è¯¯å¤„ç†

- **APIè°ƒç”¨å¤±è´¥**ï¼šå®ç°é‡è¯•æœºåˆ¶å’Œé™çº§ç­–ç•¥
- **ç¿»è¯‘å¤±è´¥**ï¼šè‡ªåŠ¨é€€æ¬¾ï¼ˆå·²åœ¨ `updateMediaTaskById` ä¸­å®ç°ï¼‰
- **å­˜å‚¨å¤±è´¥**ï¼šä½¿ç”¨åŸå§‹URLä½œä¸ºé™çº§æ–¹æ¡ˆ

### 4. æ€§èƒ½ä¼˜åŒ–

- **å­—å¹•è½¬æ¢**ï¼šå¤§æ–‡ä»¶åˆ†å—å¤„ç†
- **ç¿»è¯‘**ï¼šè¶…è¿‡5000å­—ç¬¦è‡ªåŠ¨åˆ†å—ï¼ˆå·²åœ¨Geminiç¿»è¯‘å™¨ä¸­å®ç°ï¼‰
- **è§†é¢‘ä¸Šä¼ **ï¼šæµå¼ä¸Šä¼ ï¼Œé¿å…å†…å­˜æº¢å‡º

---

## ğŸ“Š æ•°æ®æµå›¾

```
ç”¨æˆ·æäº¤ä»»åŠ¡
    â†“
POST /api/media/submit
    â†“
åˆ›å»ºä»»åŠ¡ï¼ˆstatus: pendingï¼‰
    â†“
å¼‚æ­¥å¤„ç†ï¼ˆprocessMediaTaskï¼‰
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 1: æå–é˜¶æ®µ                     â”‚
â”‚                                      â”‚
â”‚ 1. RapidAPIè·å–åª’ä½“ä¿¡æ¯               â”‚
â”‚    - å­—å¹•æ ¼å¼æ ‡å‡†åŒ–ï¼ˆJSON/VTTâ†’SRTï¼‰   â”‚
â”‚    - å…ƒæ•°æ®æ˜ å°„ï¼ˆdigg_countâ†’likesï¼‰   â”‚
â”‚                                      â”‚
â”‚ 2. è§†é¢‘ä¸‹è½½ï¼ˆå¦‚éœ€è¦ï¼‰                 â”‚
â”‚    - TikTok: è°ƒç”¨ä¸‹è½½ç«¯ç‚¹             â”‚
â”‚    - ä¸Šä¼ åˆ°Vercel Blob               â”‚
â”‚                                      â”‚
â”‚ 3. ä¿å­˜åˆ°æ•°æ®åº“                       â”‚
â”‚    - subtitleRaw                    â”‚
â”‚    - videoUrlInternal               â”‚
â”‚    - expiresAt                      â”‚
â”‚    - status: 'extracted'            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
UIæ˜¾ç¤º"å¼€å§‹ç¿»è¯‘"æŒ‰é’®ï¼ˆstatus === 'extracted'ï¼‰
    â†“
ç”¨æˆ·é€‰æ‹©è¯­è¨€å¹¶ç‚¹å‡»"å¼€å§‹ç¿»è¯‘"
    â†“
POST /api/media/translate
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 2: ç¿»è¯‘é˜¶æ®µ                     â”‚
â”‚                                      â”‚
â”‚ 1. éªŒè¯ä»»åŠ¡çŠ¶æ€ï¼ˆå¿…é¡»æ˜¯ 'extracted'ï¼‰ â”‚
â”‚ 2. æ£€æŸ¥å­—å¹•å†…å®¹ï¼ˆsubtitleRawå­˜åœ¨ï¼‰   â”‚
â”‚ 3. æ‰£é™¤ç§¯åˆ†                          â”‚
â”‚ 4. æ›´æ–°çŠ¶æ€ä¸º 'translating'          â”‚
â”‚ 5. è°ƒç”¨Geminiç¿»è¯‘                    â”‚
â”‚ 6. ä¿å­˜ç¿»è¯‘ç»“æœ                      â”‚
â”‚    - subtitleTranslated             â”‚
â”‚    - targetLang                     â”‚
â”‚    - status: 'completed'            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
UIæ˜¾ç¤ºç¿»è¯‘ç»“æœï¼ˆstatus === 'completed'ï¼‰
```

---

## âœ… ç¡®è®¤æ¸…å•

åœ¨å¼€å§‹å®æ–½å‰ï¼Œè¯·ç¡®è®¤ï¼š

- [ ] RapidAPIé…ç½®å·²æ­£ç¡®è®¾ç½®ï¼ˆç¯å¢ƒå˜é‡ï¼‰
- [ ] Vercel Blobå·²é…ç½®ï¼ˆ`BLOB_READ_WRITE_TOKEN`ï¼‰
- [ ] Gemini API Keyå·²é…ç½®ï¼ˆ`GEMINI_API_KEY`ï¼‰
- [ ] æ•°æ®åº“Schemaå·²åŒ…å«æ‰€æœ‰å¿…è¦å­—æ®µï¼ˆâœ… å·²ç¡®è®¤å­˜åœ¨ï¼‰
- [ ] ç¿»è¯‘APIè·¯ç”±å·²å­˜åœ¨ï¼ˆâœ… å·²ç¡®è®¤å­˜åœ¨ï¼‰

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0  
**åˆ›å»ºæ—¶é—´ï¼š** 2024-12-19  
**æœ€åæ›´æ–°ï¼š** åŸºäºæœ€ç»ˆæŠ€æœ¯è§„æ ¼è¯´æ˜å’Œä»£ç åº“åˆ†æ
