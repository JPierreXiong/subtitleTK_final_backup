# 自定义需求改写功能优化方案

## 📊 现状分析

经过代码检查，**自定义需求改写功能已经完全实现**！

### ✅ 已实现的功能

1. **UI 层面**：
   - ✅ 自定义需求输入框（带紫色呼吸灯效果）
   - ✅ 快捷需求标签（6个常用标签）
   - ✅ 字符限制提示（500字符，带颜色警告）
   - ✅ 按钮文字动态变化（"开始改写" / "按要求改写"）
   - ✅ 多语言支持（中文、英文、法文）

2. **后端层面**：
   - ✅ `buildRewritePrompt` 支持 `userRequirement` 参数
   - ✅ 用户需求优先级最高（明确提示"如果用户需求与预设风格有冲突，请以用户需求为准"）
   - ✅ API 路由接收 `userRequirement`
   - ✅ 流式输出支持

3. **数据流**：
   - ✅ 前端 → Hook → API → Gemini → 流式返回 → 前端显示

---

## 🎯 优化方案

虽然功能已实现，但可以**增强用户体验和可发现性**：

### 方案一：增强 UI 提示（推荐）

**目标**：让用户更容易发现和使用自定义需求功能

#### 1.1 添加"使用示例"按钮

在输入框上方添加一个"💡 查看示例"按钮，点击后显示常见使用场景：

```tsx
// 示例场景
const exampleScenarios = [
  {
    title: "引导关注",
    example: "请把结尾改成引导用户去主页领取免费资料",
    icon: "🎯"
  },
  {
    title: "年龄定位",
    example: "针对 20 岁左右的年轻人，加入更多网络流行语",
    icon: "👥"
  },
  {
    title: "风格转换",
    example: "改成脱口秀风格，加入更多吐槽和自嘲",
    icon: "🎭"
  },
  {
    title: "语言优化",
    example: "翻译成地道美语，使用俚语和口语化表达",
    icon: "🌍"
  }
];
```

#### 1.2 添加"智能提示"

当用户输入时，根据关键词提供智能提示：

- 输入"结尾" → 提示："可以要求修改结尾，如：'把结尾改成引导关注'"
- 输入"风格" → 提示："可以指定风格，如：'改成脱口秀风格'"
- 输入"年龄" → 提示："可以指定目标受众，如：'针对 20 岁左右的年轻人'"

#### 1.3 优化占位符文字

当前占位符：
```
"输入你的特定改写要求，Gemini 将为您深度定制..."
```

优化为更具体的示例：
```
"例如：把结尾改成引导关注 / 针对 20 岁年轻人 / 改成脱口秀风格..."
```

### 方案二：增强 Prompt 工程（可选）

**目标**：确保用户需求真正被优先执行

#### 2.1 添加需求解析逻辑

在 `buildRewritePrompt` 中，解析用户需求的关键词：

```typescript
// 检测用户需求类型
const detectRequirementType = (requirement: string) => {
  const types = {
    ending: /结尾|结束|最后|收尾/i,
    audience: /针对|面向|适合|受众/i,
    style: /风格|方式|形式|类型/i,
    tone: /语气|语调|口吻|感觉/i,
    length: /长度|篇幅|缩短|精简/i,
  };
  
  // 返回检测到的类型，用于优化 Prompt
};
```

#### 2.2 优化 Prompt 结构

根据检测到的需求类型，调整 Prompt 结构：

```typescript
// 如果用户要求修改结尾
if (detectRequirementType(userRequirement).includes('ending')) {
  prompt += "\n【特别强调】：请重点优化结尾部分，确保结尾有强烈的行动号召（CTA）。";
}
```

### 方案三：添加"需求模板库"（可选）

**目标**：提供常用需求模板，降低用户输入门槛

#### 3.1 创建需求模板

```typescript
const requirementTemplates = [
  {
    id: 'guide-follow',
    name: '引导关注',
    template: '请把结尾改成引导用户去主页/评论区领取免费资料',
    category: 'conversion'
  },
  {
    id: 'age-target',
    name: '年龄定位',
    template: '针对 {age} 岁左右的{audience}，使用他们熟悉的网络流行语',
    category: 'audience'
  },
  {
    id: 'style-convert',
    name: '风格转换',
    template: '改成{style}风格，加入更多{feature}',
    category: 'style'
  },
  // ... 更多模板
];
```

#### 3.2 UI 展示模板

在输入框下方添加"需求模板"区域，用户可以：
- 点击模板快速填充
- 自定义模板参数（年龄、风格等）

---

## 🚀 推荐实施顺序

### Phase 1：快速优化（1-2小时）

1. ✅ **优化占位符文字**（更具体的示例）
2. ✅ **添加"使用示例"按钮**（点击显示常见场景）
3. ✅ **增强快捷标签**（添加更多常用需求）

### Phase 2：体验优化（2-3小时）

1. ✅ **添加智能提示**（根据输入关键词提示）
2. ✅ **优化 Prompt 结构**（根据需求类型调整）

### Phase 3：高级功能（可选）

1. ✅ **需求模板库**（提供常用模板）
2. ✅ **需求历史记录**（保存用户常用的需求）

---

## 📝 具体实施建议

### 建议 1：立即优化占位符（最简单）

**文件**：`src/config/locale/messages/zh/ai/media.json`

```json
{
  "custom_requirement": {
    "placeholder": "例如：把结尾改成引导关注 / 针对 20 岁年轻人 / 改成脱口秀风格..."
  }
}
```

### 建议 2：添加使用示例按钮（中等难度）

**文件**：`src/shared/blocks/generator/media.tsx`

在输入框上方添加：
```tsx
<Button 
  variant="ghost" 
  size="sm"
  onClick={() => setShowExamples(!showExamples)}
>
  💡 查看使用示例
</Button>
```

### 建议 3：增强快捷标签（简单）

**文件**：`src/config/locale/messages/zh/ai/media.json`

添加更多快捷标签：
```json
{
  "quick_tags": {
    "guide_follow": "引导关注",
    "age_20s": "针对 20 岁",
    "standup_style": "脱口秀风格",
    "add_sarcasm": "加入吐槽"
  }
}
```

---

## ✅ 总结

**现状**：功能已完全实现 ✅

**优化方向**：
1. **可发现性**：让用户更容易发现自定义需求功能
2. **易用性**：提供示例和模板，降低使用门槛
3. **智能化**：根据输入提供智能提示

**推荐**：先实施 Phase 1（快速优化），这些改动小但效果明显。

---

## 🤔 需要确认

1. **是否需要添加"使用示例"功能？**
2. **是否需要优化占位符文字？**
3. **是否需要添加更多快捷标签？**
4. **是否需要实施智能提示功能？**

**请确认优化方向，我将开始实施！** 🚀
