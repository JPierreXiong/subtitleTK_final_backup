# å®æ–½å®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. RapidAPIé€‚é…å™¨å¢å¼º âœ…

#### 1.1 TikTokè§†é¢‘ä¸‹è½½ç«¯ç‚¹æ”¯æŒ
**æ–‡ä»¶ï¼š** `src/extensions/media/rapidapi.ts`

**ä¿®æ”¹å†…å®¹ï¼š**
- âœ… å¢å¼º `fetchTikTokVideoDownloadFreeAPI` æ–¹æ³•
- âœ… æ”¯æŒæ–°çš„ç«¯ç‚¹ï¼š`tiktok-download-video1.p.rapidapi.com`
- âœ… ä½¿ç”¨ "Download Video by URL" ç«¯ç‚¹ï¼š`/download/video/by/url`
- âœ… å…¼å®¹æ—§ç«¯ç‚¹ï¼š`snap-video3.p.rapidapi.com`
- âœ… å¢å¼ºè§†é¢‘URLæå–é€»è¾‘ï¼Œæ”¯æŒå¤šç§å“åº”æ ¼å¼ï¼š
  - `data.play` (tiktok-download-video1 ä¸»è¦å­—æ®µ)
  - `data.download_addr` (tiktok-download-video1 å¤‡ç”¨å­—æ®µ)
  - å…¶ä»–å…¼å®¹å­—æ®µ

**ä»£ç ä½ç½®ï¼š** ç¬¬1664-1807è¡Œ

#### 1.2 å­—å¹•æ ¼å¼è½¬æ¢å™¨
**æ–‡ä»¶ï¼š** `src/extensions/media/subtitle-formatter.ts`

**çŠ¶æ€ï¼š** âœ… å·²å®Œæ•´å®ç°
- âœ… JSONæ•°ç»„ â†’ SRT è½¬æ¢
- âœ… VTT â†’ SRT è½¬æ¢
- âœ… SRTæ ¼å¼éªŒè¯
- âœ… è‡ªåŠ¨æ ¼å¼æ£€æµ‹

**æ— éœ€ä¿®æ”¹ã€‚**

#### 1.3 å…ƒæ•°æ®æ˜ å°„å™¨å¢å¼º
**æ–‡ä»¶ï¼š** `src/extensions/media/rapidapi.ts`

**ä¿®æ”¹å†…å®¹ï¼š**
- âœ… å¢å¼ºTikTokå…ƒæ•°æ®æ˜ å°„ï¼Œæ”¯æŒæ›´å¤šå­—æ®µå˜ä½“ï¼š
  - `statistics.digg_count` â†’ `likes`
  - `statistics.likes` â†’ `likes` (æ–°å¢)
  - `statistics.play_count` â†’ `views`
  - `statistics.views` â†’ `views` (æ–°å¢)
  - `statistics.share_count` â†’ `shares`
  - `statistics.shares` â†’ `shares` (æ–°å¢)

**ä»£ç ä½ç½®ï¼š** ç¬¬1518-1598è¡Œ

---

### 2. ç¿»è¯‘æµç¨‹ä¼˜åŒ– âœ…

#### 2.1 ç¿»è¯‘APIè·¯ç”±
**æ–‡ä»¶ï¼š** `src/app/api/media/translate/route.ts`

**çŠ¶æ€ï¼š** âœ… å·²å®Œæ•´å®ç°
- âœ… æ·»åŠ  `translating` çŠ¶æ€æ›´æ–°ï¼ˆç¬¬110-115è¡Œï¼‰
- âœ… ä¿å­˜ `targetLang` å­—æ®µï¼ˆç¬¬112è¡Œï¼‰
- âœ… è¿›åº¦æ›´æ–°ï¼ˆ0-100%ï¼‰
- âœ… é”™è¯¯å¤„ç†å’Œç§¯åˆ†é€€æ¬¾

**æ— éœ€ä¿®æ”¹ã€‚**

---

### 3. å‰ç«¯Hookå¢å¼º âœ…

#### 3.1 use-media-task Hook
**æ–‡ä»¶ï¼š** `src/shared/hooks/use-media-task.ts`

**çŠ¶æ€ï¼š** âœ… å·²å®Œæ•´å®ç°
- âœ… `startTranslation` æ–¹æ³•å·²å®ç°ï¼ˆç¬¬212-248è¡Œï¼‰
- âœ… è½®è¯¢é€»è¾‘æ”¯æŒ `extracted` å’Œ `translating` çŠ¶æ€
- âœ… é”™è¯¯å¤„ç†å’Œç”¨æˆ·æç¤º

**æ— éœ€ä¿®æ”¹ã€‚**

---

### 4. å‰ç«¯UIä¸¤é˜¶æ®µæµç¨‹ âœ…

#### 4.1 MediaExtractorç»„ä»¶
**æ–‡ä»¶ï¼š** `src/shared/blocks/generator/media.tsx`

**çŠ¶æ€ï¼š** âœ… å·²å®Œæ•´å®ç°

**ç¬¬ä¸€é˜¶æ®µï¼ˆæå–ï¼‰ï¼š**
- âœ… æå–æŒ‰é’®ï¼šå§‹ç»ˆå¯ç”¨ï¼ˆå¦‚æœURLæœ‰æ•ˆï¼‰
- âœ… æå–ä¸­ï¼šæ˜¾ç¤ºè¿›åº¦æ¡å’ŒçŠ¶æ€æ–‡æœ¬
- âœ… çŠ¶æ€ï¼š`pending` â†’ `processing` â†’ `extracted`

**ç¬¬äºŒé˜¶æ®µï¼ˆç¿»è¯‘ï¼‰ï¼š**
- âœ… ç¿»è¯‘æŒ‰é’®ï¼šä»…åœ¨ `status === 'extracted'` ä¸”æœ‰å­—å¹•æ—¶æ˜¾ç¤º
- âœ… è¯­è¨€é€‰æ‹©å™¨ï¼šä»…åœ¨ `extracted` çŠ¶æ€æ—¶å¯ç”¨
- âœ… ç¿»è¯‘ä¸­ï¼šæ˜¾ç¤º "Translating..." çŠ¶æ€
- âœ… çŠ¶æ€ï¼š`extracted` â†’ `translating` â†’ `completed`

**å…³é”®ä»£ç ä½ç½®ï¼š**
- æå–æŒ‰é’®ï¼šç¬¬859-873è¡Œ
- ç¿»è¯‘æŒ‰é’®ï¼šç¬¬824-841è¡Œï¼ˆå­—å¹•æ¨¡å¼ï¼‰ã€ç¬¬787-805è¡Œï¼ˆè§†é¢‘æ¨¡å¼ï¼‰
- è¯­è¨€é€‰æ‹©å™¨ï¼šç¬¬626-653è¡Œ

---

## ğŸ“‹ æŠ€æœ¯è§„æ ¼ç¡®è®¤

### RapidAPIé…ç½®
- âœ… YouTubeå­—å¹•ï¼š`youtube-transcriptor.p.rapidapi.com`
- âœ… TikTokå­—å¹•ï¼š`tiktok-transcriptor-api3.p.rapidapi.com`
- âœ… TikTokä¸‹è½½ï¼š`tiktok-download-video1.p.rapidapi.com`ï¼ˆæ–°å¢æ”¯æŒï¼‰

### æ•°æ®åº“å­—æ®µï¼ˆå·²å­˜åœ¨ï¼Œæ— éœ€ä¿®æ”¹ï¼‰
- âœ… `subtitle_raw` (text) - åŸå§‹å­—å¹•æ–‡æœ¬
- âœ… `subtitle_translated` (text) - ç¿»è¯‘åå­—å¹•æ–‡æœ¬
- âœ… `video_url_internal` (text) - Vercel Blobå­˜å‚¨æ ‡è¯†ç¬¦
- âœ… `expires_at` (timestamp) - 24å°æ—¶è¿‡æœŸæ—¶é—´
- âœ… `target_lang` (text) - ç”¨æˆ·é€‰æ‹©çš„ç›®æ ‡è¯­è¨€
- âœ… `output_type` (text) - 'subtitle' | 'video'
- âœ… `status` (text) - pending, processing, extracted, translating, completed, failed

### UIäº¤äº’æµç¨‹
- âœ… **ç¬¬ä¸€é˜¶æ®µï¼ˆæå–ï¼‰**ï¼šç”¨æˆ·ç‚¹å‡»"æå–" â†’ 3åˆ†é’Ÿå¤„ç† â†’ å®Œæˆåæ¿€æ´»"å¼€å§‹ç¿»è¯‘"æŒ‰é’®
- âœ… **ç¬¬äºŒé˜¶æ®µï¼ˆç¿»è¯‘ï¼‰**ï¼šç”¨æˆ·é€‰æ‹©è¯­è¨€ â†’ ç‚¹å‡»"å¼€å§‹ç¿»è¯‘" â†’ 1åˆ†é’Ÿå¤„ç† â†’ å®Œæˆ

### çŠ¶æ€æœº
- âœ… `pending`: åˆšæäº¤ä»»åŠ¡
- âœ… `processing`: ç¬¬ä¸€é˜¶æ®µï¼ˆæå–å…ƒæ•°æ® + åŸå§‹å­—å¹• + [å¯é€‰]ä¸‹è½½è§†é¢‘åˆ°Vercel Blobï¼‰
- âœ… `extracted`: ç¬¬ä¸€é˜¶æ®µå®Œæˆï¼ˆUIæ­¤æ—¶æ¿€æ´»"å¼€å§‹ç¿»è¯‘"æŒ‰é’®ï¼‰
- âœ… `translating`: ç¬¬äºŒé˜¶æ®µï¼ˆGeminiç¿»è¯‘ä¸­ï¼‰
- âœ… `completed`: å…¨éƒ¨å®Œæˆ
- âœ… `failed`: ä»»åŠ¡å¤±è´¥

---

## ğŸ” ä»£ç ä¿®æ”¹æ¸…å•

### ä¿®æ”¹çš„æ–‡ä»¶

1. **src/extensions/media/rapidapi.ts**
   - å¢å¼º `fetchTikTokVideoDownloadFreeAPI` æ–¹æ³•ï¼ˆæ”¯æŒæ–°ç«¯ç‚¹ï¼‰
   - å¢å¼º `normalizeMetadata` æ–¹æ³•ï¼ˆTikTokå­—æ®µæ˜ å°„ï¼‰

### æ— éœ€ä¿®æ”¹çš„æ–‡ä»¶ï¼ˆå·²å®Œæ•´å®ç°ï¼‰

1. **src/extensions/media/subtitle-formatter.ts** - å­—å¹•æ ¼å¼è½¬æ¢å™¨
2. **src/app/api/media/translate/route.ts** - ç¿»è¯‘APIè·¯ç”±
3. **src/shared/hooks/use-media-task.ts** - å‰ç«¯Hook
4. **src/shared/blocks/generator/media.tsx** - å‰ç«¯UIç»„ä»¶
5. **src/config/db/schema.ts** - æ•°æ®åº“Schema

---

## âœ… æµ‹è¯•å»ºè®®

### 1. TikTokè§†é¢‘ä¸‹è½½æµ‹è¯•
- [ ] æµ‹è¯• `tiktok-download-video1.p.rapidapi.com` ç«¯ç‚¹
- [ ] éªŒè¯è§†é¢‘URLæå–ï¼ˆ`data.play` æˆ– `data.download_addr`ï¼‰
- [ ] éªŒè¯Vercel Blobä¸Šä¼ 

### 2. å­—å¹•æ ¼å¼è½¬æ¢æµ‹è¯•
- [ ] JSONæ•°ç»„æ ¼å¼è½¬æ¢
- [ ] VTTæ ¼å¼è½¬æ¢
- [ ] SRTæ ¼å¼éªŒè¯

### 3. ä¸¤é˜¶æ®µæµç¨‹æµ‹è¯•
- [ ] æå–é˜¶æ®µï¼šæäº¤ä»»åŠ¡ â†’ ç­‰å¾…å®Œæˆ â†’ çŠ¶æ€å˜ä¸º `extracted`
- [ ] ç¿»è¯‘é˜¶æ®µï¼šé€‰æ‹©è¯­è¨€ â†’ ç‚¹å‡»ç¿»è¯‘ â†’ çŠ¶æ€å˜ä¸º `translating` â†’ å®Œæˆ
- [ ] é”™è¯¯å¤„ç†ï¼šæµ‹è¯•å„ç§å¤±è´¥åœºæ™¯

### 4. å…ƒæ•°æ®æ˜ å°„æµ‹è¯•
- [ ] TikTokä¸åŒAPIå“åº”æ ¼å¼çš„å…ƒæ•°æ®æå–
- [ ] YouTubeä¸åŒAPIå“åº”æ ¼å¼çš„å…ƒæ•°æ®æå–

---

## ğŸ¯ å®æ–½ç»“æœ

### æ ¸å¿ƒåŠŸèƒ½
âœ… **ä¸¤é˜¶æ®µUIæµç¨‹**ï¼šæå– â†’ ç¿»è¯‘ï¼Œå®Œå…¨å®ç°
âœ… **TikTokè§†é¢‘ä¸‹è½½**ï¼šæ”¯æŒæ–°ç«¯ç‚¹ `tiktok-download-video1`
âœ… **å­—å¹•æ ¼å¼è½¬æ¢**ï¼šæ”¯æŒJSON/VTT/SRTå¤šç§æ ¼å¼
âœ… **å…ƒæ•°æ®æ˜ å°„**ï¼šå…¼å®¹ä¸åŒAPIå“åº”æ ¼å¼
âœ… **ç¿»è¯‘æµç¨‹**ï¼šæ”¯æŒ `translating` çŠ¶æ€å’Œ `targetLang` ä¿å­˜

### ShipAnyç»“æ„ä¿æŠ¤
âœ… **æœªæ”¹åŠ¨**ï¼š`src/core/` ç›®å½•ç»“æ„
âœ… **æœªæ”¹åŠ¨**ï¼šæ•°æ®åº“Schemaå®šä¹‰æ–¹å¼
âœ… **æœªæ”¹åŠ¨**ï¼šè®¤è¯å’Œæƒé™ç³»ç»Ÿ
âœ… **æœªæ”¹åŠ¨**ï¼šé…ç½®ç®¡ç†æ–¹å¼

### ä»£ç è´¨é‡
âœ… **æ— Linteré”™è¯¯**ï¼šæ‰€æœ‰ä¿®æ”¹é€šè¿‡ä»£ç æ£€æŸ¥
âœ… **å‘åå…¼å®¹**ï¼šä¿æŒä¸ç°æœ‰ä»£ç çš„å…¼å®¹æ€§
âœ… **é”™è¯¯å¤„ç†**ï¼šå®Œæ•´çš„é”™è¯¯å¤„ç†å’Œé™çº§ç­–ç•¥

---

## ğŸ“ åç»­å»ºè®®

1. **ç¯å¢ƒå˜é‡é…ç½®**
   - ç¡®è®¤ `RAPIDAPI_TIKTOK_VIDEO_PRIMARY_HOST` è®¾ç½®ä¸º `tiktok-download-video1.p.rapidapi.com`
   - ç¡®è®¤å…¶ä»–RapidAPIé…ç½®æ­£ç¡®

2. **ç›‘æ§å’Œæ—¥å¿—**
   - æ·»åŠ æ–°ç«¯ç‚¹çš„è°ƒç”¨æ—¥å¿—
   - ç›‘æ§è§†é¢‘ä¸‹è½½æˆåŠŸç‡
   - ç›‘æ§ç¿»è¯‘æˆåŠŸç‡

3. **æ€§èƒ½ä¼˜åŒ–**
   - è€ƒè™‘æ·»åŠ è§†é¢‘ä¸‹è½½ç¼“å­˜
   - ä¼˜åŒ–é•¿å­—å¹•çš„ç¿»è¯‘æ€§èƒ½

---

**å®æ–½å®Œæˆæ—¶é—´ï¼š** 2024-12-19  
**å®æ–½çŠ¶æ€ï¼š** âœ… å…¨éƒ¨å®Œæˆ  
**ä»£ç è´¨é‡ï¼š** âœ… é€šè¿‡æ£€æŸ¥
